
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Vis: Small Multiples &#8212; Data Science for Engineers</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Grama: Exploratory Model Analysis" href="d18-e-grama04-ema-solution.html" />
    <link rel="prev" title="Data: Joining Datasets" href="d16-e-data05-join-solution.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Data Science for Engineers</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../frontmatter/home.html">
                    Data Science for Engineers
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../frontmatter/setup.html">
   Software Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../frontmatter/howto.html">
   How To Use These Materials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../frontmatter/schedule.html">
   Course Topics and Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../frontmatter/submission.html">
   Challenge Submission Instructions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../frontmatter/recordings.html">
   Class Recordings
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../frontmatter/demos.html">
   Demo Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../demos/demo2022-06-20-1.html">
     Demo Notebook 2022-06-20
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../demos/demo2022-06-27.html">
     Demo Notebook 2022-06-27
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../demos/demo2022-07-06.html">
     Demo Notebook 2022-07-06
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../demos/demo2022-07-11.html">
     Demo Notebook 2022-07-11
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../frontmatter/hours.html">
   Office Hours Schedule
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../frontmatter/exercises.html">
   Exercise Solutions
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="d01-e-data00-notebooks-solution.html">
     Introduction to Jupyter Notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d01-e-vis00-basics-solution.html">
     Vis: Data Visualization Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d02-e-data01-isolate-solution.html">
     Data: Isolating Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d02-e-tips-solution.html">
     Tips for This Course
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d03-e-stat01-eda-solution.html">
     Stats: Introduction to Exploratory Data Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d04-e-grama01-basics-solution.html">
     Grama: Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d05-e-vis01-bar-charts-solution.html">
     Vis: Bar Charts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d06-e-data02-derive-solution.html">
     Data: Deriving Quantities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d07-e-vis02-histograms-solution.html">
     Vis: Histograms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d08-e-stat02-source-solution.html">
     Stats: Real and Erroneous Sources of Variability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d09-e-vis03-scatterplot-solution.html">
     Vis: Scatterplots and Layers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d10-e-grama02-building-solution.html">
     Grama: Model Building
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d11-e-data03-pivot-solution.html">
     Data: Pivoting Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d12-e-grama03-eval-solution.html">
     Grama: Model Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d13-e-vis04-lines-solution.html">
     Vis: Lines and Related Geometries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d14-e-stat03-descriptive-solution.html">
     Stats: Descriptive Statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d15-e-data04-separate-unite-solution.html">
     Data: Separating and Uniting Columns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d16-e-data05-join-solution.html">
     Data: Joining Datasets
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Vis: Small Multiples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d18-e-grama04-ema-solution.html">
     Grama: Exploratory Model Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d19-e-stat04-distributions-solution.html">
     Stats: Distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d20-e-grama05-fit-function-solution.html">
     Grama: Fitting Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d21-e-stat05-CI-solution.html">
     Stats: Confidence Intervals and the CLT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d22-e-stat06-spc-solution.html">
     Stats: Fundamentals of Statistical Process Monitoring
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d23-e-grama06-fit-univar-solution.html">
     Grama: Fitting Univariate Distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d24-e-grama07-fit-multivar-solution.html">
     Grama: Fitting Multivariate Distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="d25-e-grama08-duu-solution.html">
     Grama: Design Under Uncertainty
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/exercises_solution/d17-e-vis05-multiples-solution.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/exercises_solution/d17-e-vis05-multiples-solution.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Vis: Small Multiples
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fundamentals-of-small-multiples">
   Fundamentals of small multiples
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q1-use-facet-wrap">
     <strong>
      q1
     </strong>
     Use
     <code class="docutils literal notranslate">
      <span class="pre">
       facet_wrap()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q2-to-free-the-scales-or-not">
     <strong>
      q2
     </strong>
     To free the scales? Or not?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finer-points">
   Finer Points
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ghost-points">
     “Ghost points”
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#q3-use-the-ghost-point-trick">
       <strong>
        q3
       </strong>
       Use the “ghost point” trick
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aside-reordering-factors">
     Aside: Reordering factors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#q4-reorder-the-carclass">
       <strong>
        q4
       </strong>
       Reorder the
       <code class="docutils literal notranslate">
        <span class="pre">
         "carclass"
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#controlling-the-facet-axis">
     Controlling the facet axis
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#q5-facet-along-a-single-axis">
       <strong>
        q5
       </strong>
       Facet along a single axis
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sinew-plots-and-facets">
     Sinew plots and facets
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Vis: Small Multiples</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Vis: Small Multiples
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setup">
     Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fundamentals-of-small-multiples">
   Fundamentals of small multiples
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q1-use-facet-wrap">
     <strong>
      q1
     </strong>
     Use
     <code class="docutils literal notranslate">
      <span class="pre">
       facet_wrap()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#q2-to-free-the-scales-or-not">
     <strong>
      q2
     </strong>
     To free the scales? Or not?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finer-points">
   Finer Points
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ghost-points">
     “Ghost points”
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#q3-use-the-ghost-point-trick">
       <strong>
        q3
       </strong>
       Use the “ghost point” trick
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aside-reordering-factors">
     Aside: Reordering factors
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#q4-reorder-the-carclass">
       <strong>
        q4
       </strong>
       Reorder the
       <code class="docutils literal notranslate">
        <span class="pre">
         "carclass"
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#controlling-the-facet-axis">
     Controlling the facet axis
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#q5-facet-along-a-single-axis">
       <strong>
        q5
       </strong>
       Facet along a single axis
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sinew-plots-and-facets">
     Sinew plots and facets
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="vis-small-multiples">
<h1>Vis: Small Multiples<a class="headerlink" href="#vis-small-multiples" title="Permalink to this headline">#</a></h1>
<p><em>Purpose</em>: A powerful idea in visualization is the <em>small multiple</em>. In this exercise you’ll learn how to design and create small multiple graphs.</p>
<blockquote>
<div><p>“At the heart of quantitative reasoning is a single question: <em>Compared to what?</em>”</p>
</div></blockquote>
<p><em>Edward Tufte on visual comparison.</em></p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">grama</span> <span class="k">as</span> <span class="nn">gr</span>
<span class="n">DF</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Intention</span><span class="p">()</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="fundamentals-of-small-multiples">
<h1>Fundamentals of small multiples<a class="headerlink" href="#fundamentals-of-small-multiples" title="Permalink to this headline">#</a></h1>
<p><strong>Facets</strong> in ggplot allow us to apply the ideas of <a class="reference external" href="https://en.wikipedia.org/wiki/Small_multiple">small multiples</a>. As an example, consider the following graph; this example introduces the new ggplot utility <code class="docutils literal notranslate"><span class="pre">facet_wrap()</span></code>. This visual depicts economic data across several decades.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## NOTE: No need to edit</span>
<span class="kn">from</span> <span class="nn">plotnine.data</span> <span class="kn">import</span> <span class="n">economics</span> <span class="k">as</span> <span class="n">df_economics</span>

<span class="p">(</span>
    <span class="n">df_economics</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_pivot_longer</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pce&quot;</span><span class="p">,</span> <span class="s2">&quot;pop&quot;</span><span class="p">,</span> <span class="s2">&quot;psavert&quot;</span><span class="p">,</span> <span class="s2">&quot;uempmed&quot;</span><span class="p">,</span> <span class="s2">&quot;unemploy&quot;</span><span class="p">],</span>
        <span class="n">names_to</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
        <span class="n">values_to</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_line</span><span class="p">()</span>
    
    <span class="c1">## Faceting allows us to implement small multiples</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s2">&quot;free_y&quot;</span><span class="p">)</span>
    
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">270</span><span class="p">))</span>

<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/facets/facet.py:390: PlotnineWarning: If you need more space for the x-axis tick text use ... + theme(subplots_adjust={&#39;wspace&#39;: 0.25}). Choose an appropriate value for &#39;wspace&#39;.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_4_1.png" src="../_images/d17-e-vis05-multiples-solution_4_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759511485308)&gt;
</pre></div>
</div>
</div>
</div>
<p>The “multiples” are the different panels; above we’ve separated the different variables into their own panel, and plotted each one against the date. This allows us to compare trends simply by looking across at different panels. For instance, we can see that <code class="docutils literal notranslate"><span class="pre">pce</span></code> and <code class="docutils literal notranslate"><span class="pre">pop</span></code> exhibit smooth growth over time, while the other variables seem to exhibit cyclical trends.</p>
<p>The faceting above works particularly well for <em>comparing trends</em>: It’s clear by inspection whether the various trends are increasing or decreasing, and we can easily see how each trend compares with others by looking at a different panel.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">facet_wrap(var)</span></code> utility takes the name of a column <code class="docutils literal notranslate"><span class="pre">var</span></code> to use as a grouping variable; each unique value in the given column will be used to construct a small multiple. You’ll practice using this utility in the next task.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## NOTE: Run this cell</span>
<span class="kn">from</span> <span class="nn">grama.data</span> <span class="kn">import</span> <span class="n">df_stang</span>
</pre></div>
</div>
</div>
</div>
<section id="q1-use-facet-wrap">
<h2><strong>q1</strong> Use <code class="docutils literal notranslate"><span class="pre">facet_wrap()</span></code><a class="headerlink" href="#q1-use-facet-wrap" title="Permalink to this headline">#</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">gr.facet_wrap()</span></code> to create a small multiple for each material <code class="docutils literal notranslate"><span class="pre">&quot;property&quot;</span></code>. Make sure to free the <code class="docutils literal notranslate"><span class="pre">y</span></code> scale in order scale both multiples to fit their data properly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## TASK: </span>
<span class="p">(</span>
    <span class="n">df_stang</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_pivot_longer</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">],</span>
        <span class="n">names_to</span><span class="o">=</span><span class="s2">&quot;property&quot;</span><span class="p">,</span>
        <span class="n">values_to</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;thick&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>

    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s2">&quot;free_y&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/facets/facet.py:390: PlotnineWarning: If you need more space for the x-axis tick text use ... + theme(subplots_adjust={&#39;wspace&#39;: 0.25}). Choose an appropriate value for &#39;wspace&#39;.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_8_1.png" src="../_images/d17-e-vis05-multiples-solution_8_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759460221188)&gt;
</pre></div>
</div>
</div>
</div>
<p>“Freeing” a scale allows it to adjust to the data. This can be a good idea if each group of values has very different numerical values (or if they have different units!). In the example above <code class="docutils literal notranslate"><span class="pre">E</span></code> and <code class="docutils literal notranslate"><span class="pre">mu</span></code> take very different numerical values (order 10,000 vs order 0.1), so freeing the scale is a good idea.</p>
<p>Freeing the scales is <em>not</em> always a good idea. The next exercise will have you consider when <em>not</em> to free the scales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plotnine.data</span> <span class="kn">import</span> <span class="n">mpg</span> 
<span class="n">df_mpg</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mpg</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_rename</span><span class="p">(</span><span class="n">carclass</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="q2-to-free-the-scales-or-not">
<h2><strong>q2</strong> To free the scales? Or not?<a class="headerlink" href="#q2-to-free-the-scales-or-not" title="Permalink to this headline">#</a></h2>
<p>Run the following code as-is and inspect the results. Answer the questions under <em>observations</em> below. Re-run the code following the instructions below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## TASK: Run this code, then try disabling the `scales` argument</span>

<span class="p">(</span>
    <span class="n">df_mpg</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_wrap</span><span class="p">(</span>
        <span class="s2">&quot;~carclass&quot;</span><span class="p">,</span> 

    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/facets/facet.py:390: PlotnineWarning: If you need more space for the x-axis tick text use ... + theme(subplots_adjust={&#39;wspace&#39;: 0.25}). Choose an appropriate value for &#39;wspace&#39;.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/facets/facet.py:396: PlotnineWarning: If you need more space for the y-axis tick text use ... + theme(subplots_adjust={&#39;hspace&#39;: 0.25}). Choose an appropriate value for &#39;hspace&#39;
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_12_1.png" src="../_images/d17-e-vis05-multiples-solution_12_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759460220185)&gt;
</pre></div>
</div>
</div>
</div>
<p><em>Observations</em></p>
<ul class="simple">
<li><p>Based on the plot above, how much <strong>visual</strong> variation is there among <code class="docutils literal notranslate"><span class="pre">2seater</span></code> vehicles, with respect to their <code class="docutils literal notranslate"><span class="pre">hwy</span></code> fuel economy and engine displacement (<code class="docutils literal notranslate"><span class="pre">displ</span></code>)?</p>
<ul>
<li><p>In this version of the plot (<code class="docutils literal notranslate"><span class="pre">scales=&quot;free&quot;</span></code>) the <code class="docutils literal notranslate"><span class="pre">hwy</span></code> and <code class="docutils literal notranslate"><span class="pre">displ</span></code> values fill up the entire panel, which gives the impression of large variability among the values.</p></li>
</ul>
</li>
<li><p>Now comment out the <code class="docutils literal notranslate"><span class="pre">scales=&quot;free&quot;</span></code> argument, re-run the code, and inspect the new plot.</p></li>
<li><p>With the new plot, how much <strong>visual</strong> variation is there among <code class="docutils literal notranslate"><span class="pre">2seater</span></code> vehicles, with respect to their <code class="docutils literal notranslate"><span class="pre">hwy</span></code> fuel economy and engine displacement (<code class="docutils literal notranslate"><span class="pre">displ</span></code>)?</p>
<ul>
<li><p>In this version of the plot (<code class="docutils literal notranslate"><span class="pre">scales=&quot;fixed&quot;</span></code>) the <code class="docutils literal notranslate"><span class="pre">hwy</span></code> and <code class="docutils literal notranslate"><span class="pre">displ</span></code> values are tightly clustered within their panel, which gives the impression of very small variability among the values.</p></li>
</ul>
</li>
</ul>
<!-- solution-end --><p>If the different groups have similar values, or if you are trying to encourage <em>numerical</em> comparisons rather than just trend comparisons, it may be a good idea to keep the scales fixed.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="finer-points">
<h1>Finer Points<a class="headerlink" href="#finer-points" title="Permalink to this headline">#</a></h1>
<p>With the basics of facets under our belt, now we can move on to some finer points about constructing small multiple plots.</p>
<section id="ghost-points">
<h2>“Ghost points”<a class="headerlink" href="#ghost-points" title="Permalink to this headline">#</a></h2>
<p>This version of the <code class="docutils literal notranslate"><span class="pre">df_mpg</span></code> plot is not as effective as it could be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## NOTE: No need to edit</span>
<span class="p">(</span>
    <span class="n">df_mpg</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;~carclass&quot;</span><span class="p">)</span> 
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_16_1.png" src="../_images/d17-e-vis05-multiples-solution_16_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759493742903)&gt;
</pre></div>
</div>
</div>
</div>
<p>With these scatterplots it’s difficult to “keep in our heads” the absolute positions of the other points as we look across the multiples. Instead we could add some “ghost points”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## NOTE: No need to edit</span>
<span class="p">(</span>
    <span class="n">df_mpg</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span>
    <span class="c1">## A bit of a trick; remove the facet variable to prevent faceting</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_mpg</span> <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_drop</span><span class="p">(</span><span class="s2">&quot;carclass&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;carclass&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/facets/facet.py:487: FutureWarning: Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_18_1.png" src="../_images/d17-e-vis05-multiples-solution_18_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759511839853)&gt;
</pre></div>
</div>
</div>
</div>
<p>Here we’re using <em>visual weight</em> to call attention to the black points within each panel, while using lower-weight grey points to de-emphasize the bulk of data. From this version of the plot we can see clearly that the <code class="docutils literal notranslate"><span class="pre">2seater</span></code> vehicles are tightly clustered <strong>and</strong> they tend to have higher <code class="docutils literal notranslate"><span class="pre">hwy</span></code> for similar <code class="docutils literal notranslate"><span class="pre">displ</span></code> vehicles.</p>
<p>There’s a trick to getting the visual above; removing the facet variable from an internal dataframe prevents the faceting of that layer. This combined with a second point layer gives the “ghost” point effect.</p>
<p>The presence of these “ghost” points provides more context; they facilitate the “Compared to what?” question that Tufte puts at the center of quantitative reasoning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">grama.data</span> <span class="kn">import</span> <span class="n">df_diamonds</span>
</pre></div>
</div>
</div>
</div>
<section id="q3-use-the-ghost-point-trick">
<h3><strong>q3</strong> Use the “ghost point” trick<a class="headerlink" href="#q3-use-the-ghost-point-trick" title="Permalink to this headline">#</a></h3>
<p>Edit the following figure to use the “ghost” point trick demonstrated above while faceting along the variable <code class="docutils literal notranslate"><span class="pre">&quot;cut&quot;</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## TASK: Add &quot;ghost points&quot; to the following plot in order to show</span>
<span class="c1">## every observation within each panel</span>
<span class="p">(</span>
    <span class="n">df_diamonds</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;carat&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_diamonds</span> <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_drop</span><span class="p">(</span><span class="s2">&quot;cut&quot;</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;cut&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/facets/facet.py:487: FutureWarning: Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_23_1.png" src="../_images/d17-e-vis05-multiples-solution_23_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759511575929)&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="aside-reordering-factors">
<h2>Aside: Reordering factors<a class="headerlink" href="#aside-reordering-factors" title="Permalink to this headline">#</a></h2>
<p>The utility function <code class="docutils literal notranslate"><span class="pre">gr.fct_reorder()</span></code> allows us to “reorder” factor levels according to another variable. This is useful because it enables us to control the <em>order</em> in which factor levels are displayed on a plot.</p>
<section id="q4-reorder-the-carclass">
<h3><strong>q4</strong> Reorder the <code class="docutils literal notranslate"><span class="pre">&quot;carclass&quot;</span></code><a class="headerlink" href="#q4-reorder-the-carclass" title="Permalink to this headline">#</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">gr.fct_reorder()</span></code> to reorder the <code class="docutils literal notranslate"><span class="pre">&quot;carclass&quot;</span></code> variable according to <code class="docutils literal notranslate"><span class="pre">&quot;hwy&quot;</span></code>. Answer the questions under <em>observations</em> below.</p>
<p><em>Hint</em>: Remember to check the documentation for a new function to learn how to use it!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## TASK: Reorder `carclass` by `hwy`</span>
<span class="p">(</span>
    <span class="n">df_mpg</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span><span class="n">carclass</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">carclass</span><span class="p">,</span> <span class="n">DF</span><span class="o">.</span><span class="n">hwy</span><span class="p">))</span>
    
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;carclass&quot;</span><span class="p">,</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_boxplot</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d17-e-vis05-multiples-solution_26_0.png" src="../_images/d17-e-vis05-multiples-solution_26_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759482652085)&gt;
</pre></div>
</div>
</div>
</div>
<p><em>Observations</em></p>
<ul class="simple">
<li><p>When you <em>do not</em> reorder <code class="docutils literal notranslate"><span class="pre">carclass</span></code>, what order are the classes listed along the horizontal axis?</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">carclass</span></code> values are listed in alphabetical order.</p></li>
</ul>
</li>
<li><p>When you <em>do</em> reorder <code class="docutils literal notranslate"><span class="pre">carclass</span></code>, what is changed about the plot? What do you notice about the boxplots?</p>
<ul>
<li><p>Now the boxplots tend to “rise” across the plot; the <code class="docutils literal notranslate"><span class="pre">carclass</span></code> values are now ordered by their median <code class="docutils literal notranslate"><span class="pre">hwy</span></code> value.</p></li>
</ul>
</li>
</ul>
<!-- solution-end --></section>
</section>
<section id="controlling-the-facet-axis">
<h2>Controlling the facet axis<a class="headerlink" href="#controlling-the-facet-axis" title="Permalink to this headline">#</a></h2>
<p>Sometimes you’ll want to place facets along the horizontal or vertical axis <em>only</em>; this is helpful when seeking to make more direct comparisons across an axis. The utility <code class="docutils literal notranslate"><span class="pre">facet_grid()</span></code> allows you to specify whether to facet along the vertical or horizontal axis of the plot.</p>
<p>For example, consider the following figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## NOTE: No need to edit</span>
<span class="p">(</span>
    <span class="n">df_mpg</span>
    <span class="c1">## Find highest fuel economy models within each manufacturer</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_group_by</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_filter</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">hwy</span> <span class="o">==</span> <span class="n">gr</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">hwy</span><span class="p">))</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_ungroup</span><span class="p">()</span>
    <span class="c1">## Reorder manufacturers based on their fuel economy</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span><span class="n">manufacturer</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">,</span> <span class="n">DF</span><span class="o">.</span><span class="n">hwy</span><span class="p">))</span>
    
    <span class="c1">## Visualize</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="c1">## Use facet_grid to control which axis gets the faceting</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_grid</span><span class="p">(</span><span class="s2">&quot;manufacturer~.&quot;</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s2">&quot;free_y&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">theme</span><span class="p">(</span><span class="n">strip_text_y</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_29_1.png" src="../_images/d17-e-vis05-multiples-solution_29_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759511580245)&gt;
</pre></div>
</div>
</div>
</div>
<p>For this visual to work I need all facets to share a common horizontal axis. Note what happens when I simply wrap the facets instead:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## NOTE: No need to edit</span>
<span class="p">(</span>
    <span class="n">df_mpg</span>
    <span class="c1">## Find highest fuel economy models within each manufacturer</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_group_by</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_filter</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">hwy</span> <span class="o">==</span> <span class="n">gr</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">hwy</span><span class="p">))</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_ungroup</span><span class="p">()</span>
    <span class="c1">## Reorder manufacturers based on their fuel economy</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_mutate</span><span class="p">(</span><span class="n">manufacturer</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">DF</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">,</span> <span class="n">DF</span><span class="o">.</span><span class="n">hwy</span><span class="p">))</span>
    
    <span class="c1">## Visualize</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="c1">## Use facet_grid to control which axis gets the faceting</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s2">&quot;free_y&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">theme</span><span class="p">(</span><span class="n">strip_text_y</span><span class="o">=</span><span class="n">gr</span><span class="o">.</span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/facets/facet.py:390: PlotnineWarning: If you need more space for the x-axis tick text use ... + theme(subplots_adjust={&#39;wspace&#39;: 0.25}). Choose an appropriate value for &#39;wspace&#39;.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_31_1.png" src="../_images/d17-e-vis05-multiples-solution_31_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759495461825)&gt;
</pre></div>
</div>
</div>
</div>
<p>This figure is essentially useless; without a common horizontal axis is it almost impossible to compare values across panels.</p>
<section id="q5-facet-along-a-single-axis">
<h3><strong>q5</strong> Facet along a single axis<a class="headerlink" href="#q5-facet-along-a-single-axis" title="Permalink to this headline">#</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">gr.facet_grid()</span></code> to facet by the <code class="docutils literal notranslate"><span class="pre">&quot;metric&quot;</span></code> column. Experiment with both forms of the argument <code class="docutils literal notranslate"><span class="pre">&quot;~metric&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;metric~.&quot;</span></code> to test faceting along the horizontal and vertical axes. Answer the questions under <em>observations</em> below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## TASK: Facet by &quot;metric&quot; along a single axis</span>
<span class="p">(</span>
    <span class="n">df_economics</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_select</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;pce&quot;</span><span class="p">,</span> <span class="s2">&quot;pop&quot;</span><span class="p">,</span> <span class="s2">&quot;psavert&quot;</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">tf_pivot_longer</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pce&quot;</span><span class="p">,</span> <span class="s2">&quot;pop&quot;</span><span class="p">,</span> <span class="s2">&quot;psavert&quot;</span><span class="p">],</span>
        <span class="n">names_to</span><span class="o">=</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span>
        <span class="n">values_to</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">geom_line</span><span class="p">()</span>
    
    <span class="o">+</span> <span class="n">gr</span><span class="o">.</span><span class="n">facet_grid</span><span class="p">(</span>
<span class="c1"># task-begin</span>
        <span class="c1">## TODO: Test both forms of the argument</span>
<span class="c1"># task-begin</span>
        <span class="s2">&quot;metric~.&quot;</span><span class="p">,</span> 
        <span class="n">scales</span><span class="o">=</span><span class="s2">&quot;free_y&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_34_1.png" src="../_images/d17-e-vis05-multiples-solution_34_1.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759495804109)&gt;
</pre></div>
</div>
</div>
</div>
<p><em>Observations</em></p>
<ul class="simple">
<li><p>Which axis does the argument <code class="docutils literal notranslate"><span class="pre">&quot;metric~.&quot;</span></code> facet along?</p>
<ul>
<li><p>Along the vertical axis (panels stacked vertically)</p></li>
</ul>
</li>
<li><p>Which axis does the argument <code class="docutils literal notranslate"><span class="pre">&quot;~metric&quot;</span></code> facet along?</p>
<ul>
<li><p>Along the horizontal axis (panels stacked horizontally)</p></li>
</ul>
</li>
<li><p>Which version of the faceting—along the horizontal or along the vertical—do you find more effective?</p>
<ul>
<li><p>I find vertical faceting more effective; this form gives all of the panels a common horizontal axis that eases comparison.</p></li>
</ul>
</li>
</ul>
<!-- solution-end --><p>The <code class="docutils literal notranslate"><span class="pre">facet_grid()</span></code> utility also allows us to facet by <em>multiple</em> columns through the syntax <code class="docutils literal notranslate"><span class="pre">gr.facet_grid(&quot;var1~var2&quot;)</span></code>. This functionality is used by a number of functions in grama.</p>
</section>
</section>
<section id="sinew-plots-and-facets">
<h2>Sinew plots and facets<a class="headerlink" href="#sinew-plots-and-facets" title="Permalink to this headline">#</a></h2>
<p>Facets show up in a variety of grama functions; for instance, the <code class="docutils literal notranslate"><span class="pre">ev_sinews()</span></code> utility has autoplot functionality that makes heavy use of facets. The autoplot facets along the horizontal axis by the inputs, and along the vertical axis by the outputs. This allows us to quickly assess how every model input affects every model output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## NOTE: No need to edit</span>
<span class="kn">from</span> <span class="nn">grama.models</span> <span class="kn">import</span> <span class="n">make_plate_buckle</span>
<span class="n">md_plate</span> <span class="o">=</span> <span class="n">make_plate_buckle</span><span class="p">()</span>

<span class="p">(</span>
    <span class="n">md_plate</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">ev_sinews</span><span class="p">(</span><span class="n">df_det</span><span class="o">=</span><span class="s2">&quot;nom&quot;</span><span class="p">)</span>
    <span class="o">&gt;&gt;</span> <span class="n">gr</span><span class="o">.</span><span class="n">pt_auto</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calling plot_sinew_outputs....
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/zach/opt/anaconda3/envs/evc/lib/python3.9/site-packages/plotnine/utils.py:371: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
</pre></div>
</div>
<img alt="../_images/d17-e-vis05-multiples-solution_38_2.png" src="../_images/d17-e-vis05-multiples-solution_38_2.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ggplot: (8759493948103)&gt;
</pre></div>
</div>
</div>
</div>
<p>We’ll learn more about this in the future exercise <code class="docutils literal notranslate"><span class="pre">e-grama04-ema</span></code>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./exercises_solution"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="d16-e-data05-join-solution.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data: Joining Datasets</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="d18-e-grama04-ema-solution.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Grama: Exploratory Model Analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Zachary del Rosario<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>